<!DOCTYPE html>
<html>
<head>
<title>X-WIDGETS DEMO</title>
<meta charset="utf-8">
<base href="../../www/">
<link rel="stylesheet" type="text/css" href="fontawesome.css">
<script src="glue.js"></script>
<script src="dom.js"></script>
<script src="css.js"></script>
<script src="purify.js"></script>
<script src="widgets.js"></script>
<script src="nav.js"></script>
<script src="input.js"></script>
<script src="list.js"></script>
<script src="grid.js"></script>
<script src="chart.js"></script>
<script src="module.js"></script>
<script src="theme-tw.js"></script>
<script src="ace/ace.js"></script>

<style>

#layout {
	height: 100%;
	display: flex;
}

#code_split {
	flex: 1;
	display: flex;
	flex-flow: column;
	border-left: 1px solid #333;
}

#result_split {
	flex: 1;
	display: flex;
	flex-flow: column;
	border-left: 1px solid #333;
}

#buttons, #result_buttons {
	display: flex;
	border-bottom: 1px solid #333;
}

#demo_list { overflow: hidden auto; padding-top: .5em; user-select: none; }
#code      { flex: 1; }
#result    { flex: 1; padding: 1em; align-content: start; }
#inspect   { flex: 1; border-top: 1px solid #333; }

#code:focus {
	outline: none;
}

.demo-list-item {
	padding: 0.2em .5em;
}

.demo-list-item:hover { background: #ddd; }
.theme-dark .demo-list-item:hover { background: #333; }
.demo-list-item.selected { background: #ddf; }
.theme-dark .demo-list-item.selected { background: #336; }

</style>

</head>

<body>

<script>

on_dom_load(function() {
	init_xmodule()
	init_components()
})

</script>

<div id=layout>
	<div id=demo_list></div>
	<div id=code_split>
		<div id=buttons class="smaller gap-x-05 p-x-05">
			<button id=run_button>Run</button>
			<button id=reload_button>Reload</button>
			<div class="S h-r gap-x-05">
				<button id=small_button>Small</button>
				<button id=large_button>Large</button>
				<button id=lights_button>Lights</button>
			</div>
		</div>
		<aceeditor id=code></aceeditor>
	</div>
	<div id=result_split>
		<div id=result_buttons class="smaller p-x-05">
			<button id=inline_button>Inline</button>
		</div>
		<div id=result class=x-container></div>
		<div id=inspect></div>
	</div>
</div>

<!--------------------------------------------------------------------------->

<template id=component_demo>
<component tag=foo>
	<script>
		let content = [...e.nodes]
		let wrapper = div({class: 'm b p h-c'}, content)
		e.set(wrapper)
	</script>
</component>

<foo>Hello!</foo>

</template>

<!--------------------------------------------------------------------------->

<template id=if_demo>
<if global=foo>
	foo was set!
</if>
<script run>
	let timer_id = runagainevery(.5, function() {
		setglobal('foo', !(window.foo))
	})
	this.on('bind', function(on) {
		if (!on)
			clearInterval(timer_id)
	})
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=tooltip_demo>
<script run>

b1 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b2 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b3 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
result.add(div({style: 'text-align: center'}, div({}, b1), div({}, b2), div({}, b3)))

b1.style['margin'] = '5em'
b2.style['margin'] = '5em'

let s1 = 'aaa v aaa'
let s2 = 'aaa v aaa<br>aaa aaa v aaa aaa'
let s3 = 'aaa v aaa<br>aaa aaa v aaa aaa<br>aaa aaa aaa v aaa aaa aaa'

b1.add(tooltip({text: html(s1), side: 'right' , align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s2), side: 'top'   , align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s3), side: 'bottom', align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s3), side: 'left'  , align: 'center', kind: 'info', close_button: false, icon_visible: true, target: b1.focus_box}))

b2.add(tooltip({text: html(s1), side: 'right' , align: 'start', close_button: true , icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s2), side: 'top'   , align: 'start', close_button: false, icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s3), side: 'bottom', align: 'start', close_button: true , icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s3), side: 'left'  , align: 'start', close_button: false, icon_visible: true, target: b2.focus_box}))

b3.add(tooltip({text: html(s1), side: 'right' , align: 'end', kind: 'error', close_button: true , icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s2), side: 'bottom', align: 'end', kind: 'error', close_button: false, icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s3), side: 'bottom', align: 'end', kind: 'error', close_button: true , icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s3), side: 'left'  , align: 'end', kind: 'error', close_button: false, icon_visible: true, target: b3.focus_box}))
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toaster_demo>
<script run>

t = toaster()
result.add(t)

t.post('Hello there', null, 1)
t.post('I\'ve got something to tell you...', 'info', 2)
t.post('Pay attention!', 'error', 3)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=notify_demo>
<script run>

notify('Did you see that?', 'info')
notify('Where?')
notify('There!', 'error', 2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=menu_demo>
<div id=main></div>
<script run>

function action(item) { pr(item.text) }

m = menu({
	popup_side: 'bottom',
	popup_align: 'left',
	popup_y1: 2,
	items: [
		{text: 'Open', action: action, key: 'Ctrl+B', icon: 'fa fa-folder-open'},
		{text: 'Close', disabled: true, icon: 'fa fa-window-close', action: action, separator: true},
		{text: 'More', items: [
			{text: 'Check', checked: true},
			{text: 'Check No Close', checked: true,
				action: function(a) { pr(a.checked); return false } },
			{text: 'More Stuff', items: [
				{text: 'More Stuff 1 this is a very long item text'},
				{text: 'More Stuff 2', action: action},
			]},
		]},
		{text: 'Even More', items: [
			{text: 'Even More Stuff 1'},
			{text: 'Even More Stuff 2'},
		]},
	],
})

b = btn({
	text: 'Click for menu',
	primary: true,
	action: function() {
		b.add(m)
	},
})

main.add(b)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=tabs_demo>
<tabs id=test_tabs selected_tab=second_page tabs_side=top style="min-height: 200px">
	<div id=test_tabs_page_1 label="First Page" id=first_page>
		<h1>This is the first page</h1>
		<p>You can put anything in here.</p>
	</div>
	<div id=test_tabs_page_2 label="Second Page" id=second_page>
		<h1>This is the second page.</h1>
		<p>You can put anything in here too.</p>
	</div>
</tabs>
</template>

<!--------------------------------------------------------------------------->

<template id=split_demo>
<split>
	<vsplit id=my_split fixed_side=first min_size=100>
		<div style="background: gray">Stuff 1</div>
		<div>Stuff 2</div>
	</vsplit>
	<vsplit fixed_side=second>
		<div>Stuff 3</div>
		<div>Stuff 4</div>
	</vsplit>
</split>
</template>

<!--------------------------------------------------------------------------->

<template id=dialog_demo>
<div id=main></div>
<script run>

win = dlg({
	w: 600,
	heading: 'I\'m playing the title',
	content: div({}, 'I\'m just here for the demo.', tag('br'), 'What do you think?'),
	buttons_layout: 'some-button < yes no > apply:ok cancel',
	buttons: {
		yes: { icon: 'fa fa-thumbs-up' },
		no: { icon: 'fa fa-thumbs-down' },
		apply: { action: function() { win.close(); }, },
	},
})

main.add(button({
	text: 'Click for modal',
	action: function() {
		win.cancelable = true
		win.modal()
	}
}))

main.add(btn({
	text: 'Modal that you can\'t close',
	action: function() {
		win.cancelable = false
		win.modal()
	}
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toolbox_demo>
<div id=main></div>
<script run>

tb = toolbox({
	id: 'my_toolbox',
	text: 'Imma toolbox',
	content: div({}, 'I\'m just here for the demo.'),
	px: 100,
	py: 100,
	pw: 150,
	ph: 300,
})

main.add(tb)

main.add(btn({
	text: 'Click to show toolbox',
	action: function() {
		tb.show().focus()
	}
}))

main.add(btn({
	text: 'Click to show another toolbox',
	action: function() {
		main.add(toolbox({
			text: 'Toolbox #'+main.len,
			content: tag('input'),
			pw: 250,
			ph: 200,
		}))
	}
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=slides_demo>
<slides>

</slides>
</template>

<!--------------------------------------------------------------------------->

<template id=md_demo>
<md>
# Sup fellow kids?

So this is a paragraph.

And this is [another](exmaple.com) one.
</md>
</template>

<!--------------------------------------------------------------------------->

<template id=pagenav_demo>
<pagenav></pagenav>
</template>

<!--------------------------------------------------------------------------->

<template id=richtext_demo>
<richtext id=my_r>
	<b>Wasup</b> <i>homies</i> ?
</richtext>
<script run>
my_r.widget_editing = true
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=check_demo>
<d class="h-m m b ro p">
	<check id=my_check checked></check><label for=my_check>Wasup</label>
</d>
</template>

<!--------------------------------------------------------------------------->

<template id=toggle_demo>
<d class="h-m m b ro p-x-2">
	<label for=my_toggle class="S">Wasup</label><toggle id=my_toggle checked></toggle>
</d>
</template>

<!--------------------------------------------------------------------------->

<template id=radio_demo>
<d class="v-m m b p ro">
	<d class="h-m"><radio id=my_radio1 group=g1 checked></radio><label for=my_radio1>Option 1</label></d>
	<d class="h-m"><radio id=my_radio2 group=g1></radio><label for=my_radio2>Option 2</label></d>
</d>
</template>

<!--------------------------------------------------------------------------->

<template id=input_demo>
<d class="grid-h grid-2col grid-m" style="grid-template-columns: 1fr 6fr">
xsmall  <span class="ro-group-h b-collapse-h xsmall  "><input class="ro-var" value="Oh My!"><button>OK</button></span>
small   <span class="ro-group-h b-collapse-h small   "><input class="ro-var" value="Oh My!"><button>OK</button></span>
smaller <span class="ro-group-h b-collapse-h smaller "><input class="ro-var" value="Oh My!"><button>OK</button></span>
normal  <span class="ro-group-h b-collapse-h normal  "><input class="ro-var" value="Oh My!"><button>OK</button></span>
large   <span class="ro-group-h b-collapse-h large   "><input class="ro-var" value="Oh My!"><button>OK</button></span>
xlarge  <span class="ro-group-h b-collapse-h xlarge  "><input class="ro-var" value="Oh My!"><button>OK</button></span>
</d>
</template>

<!--------------------------------------------------------------------------->

<template id=inputbox_demo>

<d class="S h ro-group-h b-collapse-h">
	<inputbox class="ro-var">
		<d class="ro-var h-m p-x fa fa-car"></d>
		<labelbox class="ro-var">
			<label for=oh_my>On my label</label>
			<inputbox>
				<button bare icon="fa fa-bicycle"></button>
				<input id=oh_my value="Oh My!">
				<d class="ro-var h-m p-x fa fa-bicycle"></d>
			</inputbox>
		</labelbox>
		<button>...</button>
		<d class="ro-var h-m p-x fa fa-truck"></d>
		<button><d class="icon-9-dots"></d></button>
	</inputbox><button>OK</button>
</d>

</template>

<!--------------------------------------------------------------------------->

<template id=button_demo>
<p>
	<button id=cancel_button confirm="U sure?" class=large>Cancel</button>, says the button.
	<button id=danger_button danger>Don't do it Jonny!</button>, says another.
	<button icon="fa fa-recycle" bare></button>
</p>
<p>
	<button primary>OK</button>
	<button icon="fa fa-biohazard">Click&nbsp;<i>me</i>&nbsp;too!</button>
	<button bare icon="fa fa-play">I'm also a button</button>
	<script run>
		this.parent.add(button({
			text: html('Multiline text<br>works too!'),
			icon: 'fa fa-folder-open',
			action: function() { this.debug('clicked') },
		}))

		danger_button.action = function() {
			cancel_button.click()
		}
		cancel_button_action = function() {
			this.debug('clicked')
		}
	</script>
</p>
</template>

<!--------------------------------------------------------------------------->

<template id=info_demo>
<info id=my_info>
	<h3>It never entered my mind, but</h3>
	<p>Here we are</p>
</info>
<button action=toggle_collapsed>Toggle Collapsed</button>
<script run>
toggle_collapsed = function() {
	my_info.collapsed = !my_info.collapsed
}
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=input_align_demo>
<d class="grid-h grid-m grid-2col gap-x" style="grid-template-columns: 5em auto">
	<check  class="self-h-c" id=check1></check><label for=check1>Check me baby</label>
	<radio  class="self-h-c" id=radio1 group=g1></radio><label for=radio1>Pick me</label>
	<radio  class="self-h-c" id=radio2 group=g1></radio><label for=radio2>No, pick me!</label>
	<toggle class="self-h-c" id=toggle1></toggle><label for=toggle1>Toggle me</label>
	<d></d><label for=input1>Some input</label>
	<d></d><input id=input1></input>
</d>
</template>

<!--------------------------------------------------------------------------->

<template id=checkbox_demo>
<checkbox>
	Do it!
	<info>This checkbox does something</info>
</checkbox>
<toggleedit>This is the same</toggleedit>
<script run>

result.add(checkbox({
	val: 'wrong',
	field: {
		label: 'Wassup homie',
		validator_bool: field => ({
			message: 'Value must be a boolean',
			validate: isbool,
		}),
	},
}))

c2 = checkbox({
	align: 'right',
	field: {
		label: html('Yo wasup<br>I am multiline and right-aligned.'),
	},
	val: true,
})

c2.on('value_changed', function(v) { pr(v, this.checked) })

result.add(c2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=radiogroup_demo>
<radiogroup id=r1 val=1>
	<info>Info box, can put any HTML in here.<br>But it will be gray and small.</info>
	<div val=1>Choose <i>me!</i></div>
	<div val=2>Me, me<br>me, me, <b>me</b>!</div>
</radiogroup>
<div id=main></div>
<script run>

main.add(radiogroup({
	val: 'b',
	field: {
		type: 'enum',
		enum_values: 'a b c',
		enum_texts: {
			a: 'Option a',
			b: 'Option b',
			c: 'Option c',
		},
	}
}))

main.add(radiogroup({
	items: [
		unsafe_html('<div val=option_1>Option 1</div>'),
		div({val: 'option_2'}, 'Option 2'),
		div({val: 'option_3'}, T('Option 3\nMultiple lines', 'pre-line')),
	],
	val: 'wrong_option',
	field: {type: 'enum', enum_values: 'option_1 option_2 option_3'},
}))

main.add(radiogroup({
	align: 'right',
	items: [
		unsafe_html(`
			<div val=1>
				Option 1
				<info>So this is the first option and it ain\'t good</info>
			</div>
		`),
		unsafe_html('<div val=2>Option 2<info>This one is better</info></div>'),
		unsafe_html('<div val=3>Option 3<br>Multiple lines long text</div>'),
	],
	val: 3,
	field: {
		type: 'number',
		info: T('There you go, some info on the whole thing.\nDon\'t lose it!', 'pre-line'),
		validator_good: field => ({
			validate: v => v != 1,
			message: 'Told you it wasn\'t good',
		}),
	},
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=richedit_demo>
<richedit id=my_r>
	<b>Wasup</b> <i>homies</i> ?
</richedit>
</template>

<!--------------------------------------------------------------------------->

<template id=textedit_demo>
<script run>

function say_my_name(field) {
	return {
		message: 'Type in "Klaus" or leave empty.',
		validate: v => v == null || v == 'Klaus',
	}
}

function say_my_name_long(field) {
	return {
		validate: v => v == null || v == 'Klaus',
		message:
			'Type in "Klaus" or leave empty.\n' +
			'This error message is purposefully long to show that the default error box ' +
			'wraps decently.'
	}
}

result.add(div({}, 'type in "Klaus" to validate'), textedit({
	field: {
		validator_name: say_my_name,
	},
	val: 'wrong',
	info: 'Santa wants this field',
}))

result.add(div(0, 'type in "Klaus" to validate'), textedit({
	field: {
		validator_name: say_my_name_long,
	},
	copy_to_clipboard_button: true,
}))

result.add(
	div({style: 'padding-top: 2em'},
		'Check out these inner labels:',
		div({},
			textedit({
				field: {name: "santa's_name", validator_name: say_my_name},
			}),
			textedit({
				field: {label: "devil's name"},
				val: 'Anything goes',
			})
		)
	)
)

result.add(passedit({
	field: {
		validator_name: say_my_name,
		label: 'Password',
	},
	val: 'Klaus',
	info: 'Don\'t tell anyone',
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=spinedit_demo>
<spinedit val=42></spinedit>
<script run>

result.add(div({},
	spinedit({button_style: 'up-down', val: 42}),
	spinedit({button_style: 'up-down', field: {label: 'Hey hey'}})
))

result.add(div({},
	spinedit({button_style: 'left-right', val: 42}),
	spinedit({button_style: 'left-right', field: {label: 'Dis look good?'}})
))

result.add(div({},
	spinedit({val: 1, field: {min: -2, max: 5, multiple_of: 1.5}, button_placement: 'right'}),
	spinedit({field: {min: -2, max: 5, multiple_of: 1.5, label: 'How bout dis?'}, button_placement: 'right'}),
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=tagsedit_demo>
<tagsedit id=t val="apples bananas mangos"></tagsedit>
<script run>
t.add_validator('bananas', function(field) {
	return {
		validate: function(v) {
			return v.includes('bananas')
		},
		message: 'Can\'t renounce bananas',
	}
})
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=slider_demo>
<slider val=0.7 label="Slider with a very very long label" info="This is a slider"></slider>
<slider id=s1 val=0.5 label="Slider 1" info="This is another slider"></slider>
<slider id=s2 val=1500 from=1000 to=2000
	label="Slider 2" info="This is yet another slider">
	<field min=1300 max=1700 decimals=2></field>
</slider>
<script run>
s1.add_validator('custom', field => ({
		validate: v => isnum(v) && v >= .2 && v <= .8,
		message: 'Value not between .2 and .8',
	})
)
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=image_demo>
<div id=main></div>
<script run>

main.add(
	image({nav: global_val_nav(), url_template: '/media/gif/porsche.gif', w: 300, h: 200})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=placeedit_demo>
<div id=main></div>
<script run>

let api = editbox({val: 'AIzaSyAuM6W_Hh2IagBOi4zR6owafO5yNyJLGiM'})
api.on('val_changed', function(v) {
	if (v) init_google_places_api(v)
})
main.add(api)

let addr = placeedit({val: 'Somewhere'})
main.add(addr)

let gmap = googlemaps({nav: addr.nav, col: addr.col})
main.add(gmap)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=listbox_demo>
<script run>

lb = listbox({
	items: [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	],
	val_col: 0,
	val: 'Bananas',
})

hlb = hlistbox({
	items: [
		'Works',
		'Horizontally',
		'Too',
	],
})

sb = select_btn({
	items: [
		'Choose',
		'One',
		'Of',
		'Us',
	],
	val_col: 0,
	val: 'One',
})

result.add(lb, hlb, div({}, html('<h3>select_button</h3>'), sb))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=linear_form_demo>
<div class="linear-form">
	<checkbox id=c1 val=1>
		Check me baby
		<info>
			...because if you won't<br>
			somebody else will
		</info>
	</checkbox>
	<radiogroup id=r1 val=1>
		<info>Info box, can put any HTML in here.<br>But it will be gray and small.</info>
		<div val=1>Choose me!</div>
		<div val=2>Me, me<br>me, me, me!</div>
	</radiogroup>
	<textedit label=Wasup>
		<info>Wasa bii</info>
	</textedit>
</div>
</template>

<!--------------------------------------------------------------------------->

<template id=calendar_demo>
<div id=main></div>
<script run>

main.add(calendar())

/*
main.add(calendar({
	val: day(time(), 1),
	field: {
		validate: function(v) {
			if (day(v) == day(time()))
				return 'Can\'t have today.'
			if (day(v) == day(time(), 1))
				return 'Can\'t have tomorrow.'
		},
	},
}))
*/

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_demo>
<div id=main style="height: 100%; display: flex;"></div>
<script run>

let checked = () => html('<div class="fa fa-check"></div>')

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

let fields = [
	{name: 'id'        , w:  50, min_w:  30, type: 'number', editable: false},
	{name: 'index'     , w:  50, type: 'number', editable: false},
	{name: 'active'    , w:  30, type: 'bool', true_text: checked, false_text: ''},
	{name: 'name'      , w: 150, min_w:  50, max_w: 400, validate: starts_with_a, filter_by: true},
	{name: 'parent_id' , w:  50, min_w:  50, type: 'number', allow_null: true, editable: false, focusable: false},
	{name: 'random_num', w: 130, allow_null: true, type: 'number',
		label: 'Random Number',
		info: 'Just a random number\ngenerated here on the client'},
	{name: 'date'      , w: 120, allow_null: true, type: 'time', filter_by: true},
]

let rows = []

for (let i = 0; i <= 10000; i++) {
	let id         = i
	let name       = 'record '+i
	let parent_id  = i > 1 ? (i-1) % 3 : null // floor((random() * i))
	let random_num = floor(random() * 1e9)
	let random_date = clamp(i * 24 * 3600 * 10, 0, time(3000, 0))
	let active = i % 5 == 0
	let row = [id, id, active, name, parent_id, random_num, random_date]
	row.focusable = true // i % 100 >= 85
	rows.push(row)
}

g = grid({
	id: 'my_grid',
	rowset: {
		fields: fields,
		rows: rows,
		pk: 'id',
		parent_col: 'parent_id',
		index_col: 'index',
	},
	order_by: 'active name:desc',
	tree_col: 'name',
	//can_edit: false,
	can_change_header_visibility: true,
	//can_focus_cells: false,
	//order_by: 'parent_id name:desc',
	can_move_rows: true,
	//enter_edit_on_click_focused: false,
	//can_change_parent: false,
})

main.add(g)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=html_grid_demo>
<grid>
	<col-attrs for=id type=number></col-attrs>
	<rowset pk=id can_change_rows=false>
		<field name=id   ></field>
		<field name=name ></field>
		<field name=desc ></field>
		<row id=1 name=Foo desc="Le Foo"></row>
		<row id=2 name=Bar desc="Le Bar"></row>
		<row id=3 name=Baz desc="Le Baz"></row>
	</rowset>
</grid>
</template>

<!--------------------------------------------------------------------------->

<template id=date_dropdown_demo>
<div id=main></div>
<script run>

d = date_dropdown({
	val: time(),
	field: {
		type: 'date',
		validate: function(v) {
			if (day(v) == day(time()))
				return 'Can\'t have today.'
			if (day(v) == day(time(), 1))
				return 'Can\'t have tomorrow.'
		},
	},
})

main.add(d)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=list_dropdown_demo>
<div id=main></div>
<script run>

function thousand_items() {
	let a = []
	for (let i = 1; i <= 1000; i++)
		a.push('Record '+i)
	return a
}

main.add(
	list_dropdown({
		id: 'dd1',
		rowset: {
			fields: [
				{name: 'name'},
				{name: 'code'},
			],
			rows: [
				['Apples', 'a'],
				['Mananas', 'm'],
				['Bangos', 'b'],
				['Something Else Entirely', 's'],
			],
		},
		val_col: 'code',
		display_col: 'name',
		field: {
			name: 'Here we are',
			validate: function(v) {
				return v != 'm' || 'Can\'t have mananas.'
			},
		},
		val: 'm',
	}),

	list_dropdown({
		id: 'dd2',
		field: {name: 'Here we are again'},
		items: thousand_items(),
		val_col: 0,
		val: 'not-in-list',
	}),

)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_dropdown_demo>
<div id=main></div>
<script run>

main.add(
	grid_dropdown({
		rowset: {
			fields: [
				{w:  50, name: 'id', type: 'number', visible: false},
				{w: 150, name: 'name'},
				{w: 150, name: 'date', type: 'date'},
			],
			rows: [
				[1, 'Hey Dude', day(time())],
				[2, 'Wasup'   , month(time())],
				[3, 'Nuthin'  , year(time())],
			],
		},
		val_col: 'id',
		display_col: 'name',
		val: 4,
	})
)

rows2 = []
for (let i = 1; i <= 1e5; i++)
	rows2.push([i, 'Hey Dude #'+i])

main.add(
	grid_dropdown({
		rowset: {
			fields: [
				{w:  50, name: 'id', type: 'number', visible: false},
				{w: 200, name: 'name'},
			],
			rows: rows2,
		},
		val_col: 'id',
		display_col: 'name',
		val: 42,
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=countries_listbox_demo>
<div id=main></div>
<script run>

clb = countries_listbox({
	val: 'RO',
})
main.add(clb)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=country_dropdown_demo>
<div id=main></div>
<script run>

cd = country_dropdown({
	val: 'RO',
})
main.add(cd)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=dropdown_modes_demo>
<div id=main></div>
<script run>

function items() {
	return [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	]
}

function p(mode, ...args) {
	return div({style: 'margin-top: 1em'}, html('<b>'+mode+'</b> mode:<br>'), ...args)
}

main.add(
	p('default', 'variable-width, no-wrap with min-width aligned with other inputs'),
	date_dropdown({field: {type: 'date'}, val: time()}),
	div(),
	list_dropdown({items: items()}),

	p('inline', 'variable-width, no-wrap, with no min-width (shrink-wrapped), baseline-aligned'),
	date_dropdown({field: {type: 'date'}, mode: 'inline', val: time()}),
	div(),
	list_dropdown({mode: 'inline', items: items()}),

	p('wrap', 'fixed-width, auto-wrap'),
	date_dropdown({field: {type: 'date'}, mode: 'wrap', val: time()}),
	div(),
	list_dropdown({mode: 'wrap', items: items(), val: 'Something Else Entirely'}),

	p('fixed', 'fixed-width, no-wrap, overflow hidden'),
	date_dropdown({field: {type: 'date'}, mode: 'fixed', val: time()}),
	div(),
	list_dropdown({id: 'xx', mode: 'fixed', items: items(), val: 'Something Else Entirely'})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=inline_inputs_demo>
<div id=main></div>
<script run>

main.add(div({style: 'line-height: 3'},
	'All ',
	textedit({
		style: 'min-width: 4em',
		label: 'imma input',
		mode: 'inline',
		val: 'inputs',
	}),
	'are baseline-aligned',
	spinedit({
		label: 'imma spinner',
		style: 'min-width: 6em',
		mode: 'inline',
		val: 42,
	}),
	', including dropdowns ',
	/*
	date_dropdown({
		label: 'imma date',
		mode: 'inline',
	})
	,
	*/
	', which can be made to wrap-to-fit or grow-to-fit, and even',
	btn({
		text: 'buttons.',
		primary: true,
		action: function() { pr('clicked') },
	}),
	'This stays true under different fonts, font sizes and line heights.'
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=rowset_form_demo>
<div id=main></div>
<script run>

r = rowset({
	fields: [
		{w: 100, name: 'id', type: 'number'},
		{w: 100, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
})

g = grid({w: 200, h: 200, rowset: r})

i1 = input({nav: g, col: 'name'})

main.add(div({}, g), i1)

main.add(btn({
	text: 'unfocus row',
	action: function() { g.focus_cell(false) },
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=lookup_col_demo>
<div id=main></div>
<script run>

fruits = rowset({
	fields: [
		{w:  50, name: 'id', type: 'number'},
		{w: 150, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
	can_change_rows: true,
})

main.add(grid({w: 200, h: 200, rowset: fruits}))

r = rowset({
	fields: [
		{w: 100, name: 'fruit_id', type: 'number', align: 'left', label: 'fruit',
			lookup_rowset: fruits,
			lookup_col: 'id',
			display_col: 'name',
		},
	],
	rows: [
		[1],
		[2],
		[1],
	],
})

main.add(grid({w: 200, h: 200, rowset: r}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=charts_demo>
<vsplit>
	<tabs>
		<script run label=Grid>
			let g = grid({
				id: 'g',
				_label: 'Grid',
				rowset: {
					fields: [
						{name: 'date', type: 'time', has_time: false, w: 60},
						{name: 'country', w: 60},
						{name: 'sector', w: 70},
						{name: 'output', type: 'number', w: 40},
					],
					rows: [
						[year(time(), 0), 'Algeria', 'Energy'        ,  80],
						[year(time(), 1), 'Algeria', 'Chickens'      , 100],
						[year(time(), 2), 'Algeria', 'Chickens'      , 150],
						[year(time(), 0), 'Canada' , 'Chickens'      ,  20],
						[year(time(), 1), 'Canada' , 'Geese'         ,  10],
						[year(time(), 1), 'Canada' , 'Geese'         , 120],
						[year(time(), 2), 'Canada' , 'Geese'         ,  50],
						[year(time(), 0), 'Croatia', 'Science'       , 100],
						[year(time(), 0), 'Croatia', 'Chickens'      , 200],
						[year(time(), 1), 'Croatia', 'Energy'        , 150],
						[year(time(), 1), 'Croatia', 'Energy'        , 120],
						[year(time(), 2), 'Croatia', 'Chickens'      , 180],
						[year(time(), 2), 'Croatia', 'Energy'        ,  50],
					],
				},
			})
			this.parent.on_bind(function(on) {
				if (on) {
					this.items = [g]
				}
			})
		</script>
		<div label=Empty id=empty_div>This is empty to disconnect the grid.</div>
	</tabs>
	<split fixed_side=second>
		<tabs tabs_side=left>
			<chart label=Pie nav=g
				sum_cols=output
				group_cols="country sector"
			></chart>
			<chart label="Areas" nav=g
				shape=areas
				sum_cols=output
				split_cols=country
				group_cols="date/0/month/1"
			></chart>
			<chart label="Areas+Dots" nav=g
				shape=areas_dots
				sum_cols=output
				split_cols=country
				group_cols="date/0/month/1"
			></chart>
			<chart label="Lines" nav=g
				shape=lines
				sum_cols=output
				split_cols=country
				group_cols="date/0/month/1"
			></chart>
			<chart label="Lines+Dots" nav=g
				shape=lines_dots
				sum_cols=output
				split_cols=country
				group_cols="date/0/month/1"
			></chart>
			<chart label=Columns nav=g
				shape=columns
				sum_cols=output
				split_cols="country sector"
				group_cols="date/0/month/1"
			></chart>
			<chart label=Bars nav=g
				shape=bars
				sum_cols=output
				split_cols="country sector"
				group_cols="date/0/month/1"
			></chart>
			<chart label=Stacks nav=g
				shape=stacks
				sum_cols=output
				split_cols="country sector"
				group_cols="date/0/month/1"
			></chart>
		</tabs>
		<div></div>
	</split>
</vsplit>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_demo>
<div id=main></div>
<script run>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.txt',
	// timeout: 2,
	slow_timeout: .5,
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	done     : function(...args) { log('done'       , ...args) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_json_demo>
<div id=main></div>
<script run>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.json',
	upload: {a: 5, b: 7},
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	fail     : function(...args) { log('fail'       , ...args) },
	success  : function(j)       { log('success'    , json(j)) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=data_grid_demo>
<div id=main></div>
<script run>

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

var data = {
	fields: [
		{name: 'id'   , w:  60, min_w:  30, type: 'number', editable: false},
		{name: 'name' , w:  70, min_w:  50, max_w: 200, validate: starts_with_a},
		{name: 'date' , w: 140, allow_null: true, type: 'date'},
	],
	pk: 'id',
	url: 'rowset.json/test_static',
	slow_timeout: 1,
}

d = rowset(data)

g = grid({
	rowset: d,
	w: 500,
	h: 200,
})

main.add(g)

log = tag('pre')
main.add(log)

d.on('row_changed', function() {
	log.html = json(d.pack_changes(), null, 3)
})

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=query_demo>
<div id=main></div>
<script run>

d = global_rowset('test_query')

g = grid({
	rowset: d,
	w: 500,
	h: 200,
	//remove_row_on: 'exit_row',
})

main.add(g)

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=nodes_changed_demo>
<d id=my></d>
<script run>
	my.on('nodes_changed', function() {
		pr('NODES CHANGED')
	})
	runafter(0, function() {
		my.add(div())
		my.add(div())
	})
</script>
</template>

<!--------------------------------------------------------------------------->

<script>

on_dom_load(function() {
	init_components()
})

// ace.config.set('basePath', '/ace')

ace_editor = ace.edit(code, {
	mode: 'ace/mode/javascript',
	highlightActiveLine: false,
	showGutter: false,
	printMargin: false,
	displayIndentGuides: false,
	tabSize: 3,
})

// disable Tab in the editor since we need to demo tab navigation.
ace_editor.commands.removeCommand(ace_editor.commands.byName.indent)
ace_editor.commands.removeCommand(ace_editor.commands.byName.outdent)

function get_script() {
	return ace_editor.getSession().getValue()
}

function set_script(s) {
	ace_editor.getSession().setValue(s)
}

function run_script() {
	result.unsafe_html = get_script()
	inspect.clear()
	// inspect.
}

let i = 0
$('template').each(function(e) {
	if (!e.id.ends('_demo'))
		return
	let name = e.id.replace('_demo', '')
	let s = window[name+'_demo'].html.trim()
	let item = div({class: 'demo-list-item'}, name)
	demo_list.add(item)
	let i1 = i
	item.on('click', function() {

		ace_editor.getSession().setValue(s)
		ace_editor.initial_script = s
		run_script()

		let i0 = load('selected_demo_index')
		let item0 = i0 != null && demo_list.at[i0]
		if (item0)
			item0.class('selected', false)
		item.class('selected', true)
		save('selected_demo_index', i1)

	})
	i++
})

on_dom_load(function() {
	let i = load('selected_demo_index')
	let item = i != null && demo_list.at[i]
	if (item)
		item.click()
	let s = load('script')
	if (s) {
		set_script(s)
		run_script()
		save('script')
	}
})

run_button.on('click', function() {
	run_script()
})

reload_button.on('click', function() {
	save('script', get_script())
	window.location = window.location
})

lights_button.on('click', function() {
	let dark = !is_theme_dark()
	ace_editor.setTheme(dark ? 'ace/theme/tomorrow_night' : null)
	save('dark_mode', dark)
	set_theme_dark(dark)
})

inline_button.on('click', function() {
	result.switch_class('inline', 'x-container', result.hasclass('inline'))
	inline_button.bool_attr('pressed', result.hasclass('inline') || null)
})

function reset_size_buttons() {
	small_button.attr('pressed', false)
	large_button.attr('pressed', false)
}

small_button.on('click', function() {
	let v = get_theme_size() != 'small'
	reset_size_buttons()
	this.attr('pressed', v)
	save('size', v && 'medium' || null)
	set_theme_size(v && 'small')
})

large_button.on('click', function() {
	let v = get_theme_size() != 'large'
	reset_size_buttons()
	this.attr('pressed', v)
	save('size', v && 'large' || null)
	set_theme_size(v && 'large')
})

on_dom_load(function() {
	if (load('dark_mode') == 'true')
		lights_button.click()
	if (load('size') == 'medium')
		small_button.click()
	else if (load('size') == 'large')
		large_button.click()
})

</script>
</body>
</html>
