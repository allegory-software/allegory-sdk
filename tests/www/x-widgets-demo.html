<!DOCTYPE html>
<html>
<head>
<title>X-WIDGETS DEMO</title>
<meta charset="utf-8">

<script src="../../www/glue.js"></script>
<script src="../../www/divs.js"></script>
<script src="../../www/purify.js"></script>
<script src="../../www/x-widgets.js"></script>
<script src="../../www/x-nav.js"></script>
<script src="../../www/x-input.js"></script>
<script src="../../www/x-listbox.js"></script>
<script src="../../www/x-grid.js"></script>
<script src="../../www/x-chart.js"></script>
<script src="../../www/x-module.js"></script>
<script src="../../www/ace/ace.js"></script>

<link rel="stylesheet" type="text/css" href="../../www/fontawesome.css">
<link rel="stylesheet" type="text/css" href="../../www/divs.css">
<link rel="stylesheet" type="text/css" href="../../www/x-widgets.css">

<style>

#layout {
	height: 100%;
	display: flex;
}

button {
	margin: 4px 0;
}

#code_split {
	flex: 1;
	display: flex;
	flex-flow: column;
	border-left: 1px solid #333;
}

#result_split {
	flex: 1;
	display: flex;
	flex-flow: column;
	border-left: 1px solid #333;
}

#buttons {
	display: flex;
	border-bottom: 1px solid #333;
}

#demo_list { overflow: hidden auto; padding-top: .5em; user-select: none; }
#code      { flex: 1; }
#result    { flex: 1; padding: 1em; display: flex; flex-flow: column; }
#inspect   { flex: 1; border-top: 1px solid #333; }

#code:focus {
	outline: none;
}

.demo-list-item {
	padding: 0.2em .5em;
	cursor: pointer;
}

.demo-list-item:hover { background: #ddd; }
[theme=dark] .demo-list-item:hover { background: #333; }
.demo-list-item.selected { background: #ddf; }
[theme=dark] .demo-list-item.selected { background: #336; }
button { border: 1px solid #555; }
[theme=dark] button { background: #333; color: white; border: 1px solid #555; }

button[pressed] { background: #ddf; }
[theme=dark] button[pressed] { background: #336; }

/*
hack to get fontawesome fonts from a rel path so that we can serve this html
file from any CDN like githack.com.
*/
@font-face {
  font-family: 'Font Awesome 6 Free';
  font-style: normal;
  font-weight: 400;
  font-display: block;
  src: url("../../www/fa-regular-400.woff2") format("woff2"); }

.far,
.fa-regular {
  font-family: 'Font Awesome 6 Free';
  font-weight: 400; }
:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Free"; }

@font-face {
  font-family: 'Font Awesome 6 Free';
  font-style: normal;
  font-weight: 900;
  font-display: block;
  src: url("../../www/fa-solid-900.woff2") format("woff2"); }

.fas,
.fa-solid {
  font-family: 'Font Awesome 6 Free';
  font-weight: 900; }

@font-face {
  font-family: "FontAwesome";
  font-display: block;
  src: url("../../www/fa-solid-900.woff2") format("woff2"); }

@font-face {
  font-family: "FontAwesome";
  font-display: block;
  src: url("../../www/fa-brands-400.woff2") format("woff2"); }

@font-face {
  font-family: "FontAwesome";
  font-display: block;
  src: url("../../www/fa-regular-400.woff2") format("woff2");
  unicode-range: U+F003,U+F006,U+F014,U+F016-F017,U+F01A-F01B,U+F01D,U+F022,U+F03E,U+F044,U+F046,U+F05C-F05D,U+F06E,U+F070,U+F087-F088,U+F08A,U+F094,U+F096-F097,U+F09D,U+F0A0,U+F0A2,U+F0A4-F0A7,U+F0C5,U+F0C7,U+F0E5-F0E6,U+F0EB,U+F0F6-F0F8,U+F10C,U+F114-F115,U+F118-F11A,U+F11C-F11D,U+F133,U+F147,U+F14E,U+F150-F152,U+F185-F186,U+F18E,U+F190-F192,U+F196,U+F1C1-F1C9,U+F1D9,U+F1DB,U+F1E3,U+F1EA,U+F1F7,U+F1F9,U+F20A,U+F247-F248,U+F24A,U+F24D,U+F255-F25B,U+F25D,U+F271-F274,U+F278,U+F27B,U+F28C,U+F28E,U+F29C,U+F2B5,U+F2B7,U+F2BA,U+F2BC,U+F2BE,U+F2C0-F2C1,U+F2C3,U+F2D0,U+F2D2,U+F2D4,U+F2DC; }

</style>

</head>

<body>

<script>

on_dom_load(function() {
	init_xmodule()
	init_components()
})

</script>

<div id=layout>
	<div id=demo_list></div>
	<div id=code_split>
		<div id=buttons>
			<button id=run_button>Run</button>
			<button id=reload_button>Reload</button>
			<div style="flex: 1; text-align: right;">
				<button id=medium_button>Medium</button>
				<button id=large_button>Large</button>
				<button id=lights_button>Lights</button>
			</div>
		</div>
		<aceeditor id=code></aceeditor>
	</div>
	<div id=result_split>
		<div id=result></div>
		<div id=inspect></div>
	</div>
</div>

<!--------------------------------------------------------------------------->

<template id=tabs_demo>
<x-tabs selected_tab=second_page tabs_side=top>
	<div label="First Page" id=first_page>
		<h1>This is the first page</h1>
		<p>You can put anything in here.</p>
	</div>
	<div label="Second Page" id=second_page>
		<h1>This is the second page.</h1>
		<p>You can put anything in here too.</p>
	</div>
</x-tabs>
</template>

<!--------------------------------------------------------------------------->

<template id=split_demo>
<x-split>
	<x-vsplit fixed_side=first min_size=100>
		<div style="background: gray">Stuff 1</div>
		<div>Stuff 2</div>
	</x-vsplit>
	<x-vsplit fixed_side=second>
		<div>Stuff 3</div>
		<div>Stuff 4</div>
	</x-vsplit>
</x-split>
</template>

<!--------------------------------------------------------------------------->

<template id=button_demo>
<span>
	<p>
		<x-button id=wasup_button>Wasup?</x-button>, says the button.
		<x-button danger>Don't do it Jonny!</x-button>, says another.
	</p>
	<p>
		<x-button primary>Click me!</x-button>
		<x-button icon="fa fa-biohazard">Click&nbsp;<i>me</i>&nbsp;too!</x-button>
		<x-button bare icon="fa fa-play">I'm also a button</x-button>
		<script run>
			this.parent.add(button({
				text: html('Multiline text<br>works too!'),
				icon: 'fa fa-folder-open',
				action: function() { this.debug('clicked') },
			}))

			wasup_button.action = function() {
				this.debug('clicked')
			}
		</script>
	</p>
</span>
</template>

<!--------------------------------------------------------------------------->

<template id=tooltip_demo>
<div id=main></div>
<script run>

b1 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b2 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
b3 = button({text: html('aaa ^ aaa<br>aaa aaa aaa v aaa aaa aaa')})
main.add(div({style: 'text-align: center'}, div({}, b1), div({}, b2), div({}, b3)))

b1.style['margin'] = '5em'
b2.style['margin'] = '5em'

let s1 = 'aaa v aaa'
let s2 = 'aaa v aaa<br>aaa aaa v aaa aaa'
let s3 = 'aaa v aaa<br>aaa aaa v aaa aaa<br>aaa aaa aaa v aaa aaa aaa'

b1.add(tooltip({text: html(s1), side: 'right' , align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s2), side: 'top'   , align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s3), side: 'bottom', align: 'center', kind: 'info', close_button: true , icon_visible: true, target: b1.focus_box}))
b1.add(tooltip({text: html(s3), side: 'left'  , align: 'center', kind: 'info', close_button: false, icon_visible: true, target: b1.focus_box}))

b2.add(tooltip({text: html(s1), side: 'right' , align: 'start', close_button: true , icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s2), side: 'top'   , align: 'start', close_button: false, icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s3), side: 'bottom', align: 'start', close_button: true , icon_visible: true, target: b2.focus_box}))
b2.add(tooltip({text: html(s3), side: 'left'  , align: 'start', close_button: false, icon_visible: true, target: b2.focus_box}))

b3.add(tooltip({text: html(s1), side: 'right' , align: 'end', kind: 'error', close_button: true , icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s2), side: 'bottom', align: 'end', kind: 'error', close_button: false, icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s3), side: 'bottom', align: 'end', kind: 'error', close_button: true , icon_visible: true, target: b3.focus_box}))
b3.add(tooltip({text: html(s3), side: 'left'  , align: 'end', kind: 'error', close_button: false, icon_visible: true, target: b3.focus_box}))
</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toaster_demo>
<script run>

t = toaster()
result.add(t)

t.post('Hello there', null, 1)
t.post('I\'ve got something to tell you...', 'info', 2)
t.post('Pay attention!', 'error', 3)

</script>
</template>


<!--------------------------------------------------------------------------->

<template id=notify_demo>
<script run>

notify('Did you see that?', 'info')
notify('Where?')
notify('There!', 'error', 2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=dialog_demo>
<div id=main></div>
<script run>

win = dialog({
	heading: 'I\'m playing the title',
	content: div({}, 'I\'m just here for the demo.', tag('br'), 'What do you think?'),
	buttons_layout: 'some-button < yes no > apply:ok cancel',
	buttons: {
		yes: { icon: 'fa fa-thumbs-up' },
		no: { icon: 'fa fa-thumbs-down' },
	},
})

main.add(button({
	text: 'Click for modal',
	action: function() {
		win.cancelable = true
		win.modal()
	}
}))

main.add(button({
	text: 'Modal that you can\'t close',
	action: function() {
		win.cancelable = false
		win.modal()
	}
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=toolbox_demo>
<div id=main></div>
<script run>

tb = toolbox({
	text: 'Imma toolbox',
	xxx: 'yyy',
	content: div({}, 'I\'m just here for the demo.'),
	px: 400,
	py: 100,
	w: 150,
	h: 300,
})


b = button({
	text: 'Click to show toolbox',
	action: function() {
		main.add(tb)
		tb.show().focus()
	}
})

main.add(b)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=menu_demo>
<div id=main></div>
<script run>

function act(item) { pr(item.text) }

m = menu({
	items: [
		{text: 'Open', action: act, key: 'Ctrl+B', icon: 'fa fa-folder-open'},
		{text: 'Close', disabled: true, icon: 'fa fa-window-close', action: act, separator: true},
		{text: 'More', items: [
			{text: 'Check', checked: true},
			{text: 'Check No Close', checked: true,
				action: function(a) { pr(a.checked); return false } },
			{text: 'More Stuff', items: [
				{text: 'More Stuff 1 this is a very long item text'},
				{text: 'More Stuff 2', action: act},
			]},
		]},
		{text: 'Even More', items: [
			{text: 'Even More Stuff 1'},
			{text: 'Even More Stuff 2'},
		]},
	],
})

b = button({
	text: 'Click for menu',
	primary: true,
	action: function() {
		m.show(m.hidden)
	},
})

m.popup()
m.popup_side = 'bottom'
m.popup_align = 'left'
m.popup_y1 = 2
m.hide()
b.add(m)

main.add(b)

</script>
</template>


<!--------------------------------------------------------------------------->

<template id=checkbox_demo>
<style>
#result {
   grid-gap: 2px;
	align-items: start;
}
</style>
<x-checkbox>
	Do it!
	<info>This checkbox does something</info>
</x-checkbox>
<x-toggle>This is the same</x-toggle>

<script run>

result.add(checkbox({
	val: 'wrong',
	field: {
		label: 'Wassup homie',
		validator_bool: field => ({
			message: 'Value must be a boolean',
			validate: isbool,
		}),
	},
}))

c2 = checkbox({
	align: 'right',
	field: {
		label: html('Yo wasup<br>I am multiline and right-aligned.'),
	},
	val: true,
})

c2.on('value_changed', function(v) { pr(v, this.checked) })

result.add(c2)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=radiogroup_demo>
<x-radiogroup id=r1 val=1>
	<info>Info box, can put any HTML in here.<br>But it will be gray and small.</info>
	<div val=1>Choose <i>me!</i></div>
	<div val=2>Me, me<br>me, me, <b>me</b>!</div>
</x-radiogroup>
<div id=main></div>
<script run>

main.add(radiogroup({
	val: 'b',
	field: {
		type: 'enum',
		enum_values: 'a b c',
		enum_texts: {
			a: 'Option a',
			b: 'Option b',
			c: 'Option c',
		},
	}
}))

main.add(radiogroup({
	items: [
		unsafe_html('<div val=option_1>Option 1</div>'),
		div({val: 'option_2'}, 'Option 2'),
		div({val: 'option_3'}, T('Option 3\nMultiple lines', 'pre-line')),
	],
	val: 'wrong_option',
	field: {type: 'enum', enum_values: 'option_1 option_2 option_3'},
}))

main.add(radiogroup({
	align: 'right',
	items: [
		unsafe_html(`
			<div val=1>
				Option 1
				<info>So this is the first option and it ain\'t good</info>
			</div>
		`),
		unsafe_html('<div val=2>Option 2<info>This one is better</info></div>'),
		unsafe_html('<div val=3>Option 3<br>Multiple lines long text</div>'),
	],
	val: 3,
	field: {
		type: 'number',
		info: T('There you go, some info on the whole thing.\nDon\'t lose it!', 'pre-line'),
		validator_good: field => ({
			validate: v => v != 1,
			message: 'Told you it wasn\'t good',
		}),
	},
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=richtext_demo>
<div id=main></div>
<script run>

r = richtext({content: 'hey'})

r.widget_editing = true

main.add(r)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=textedit_demo>
<style>
#result {
   grid-gap: 2px;
	align-items: start;
}
</style>
<script run>

function say_my_name(field) {
	return {
		message: 'Type in "Klaus" or leave empty.',
		validate: v => v == null || v == 'Klaus',
	}
}

function say_my_name_long(field) {
	return {
		validate: v => v == null || v == 'Klaus',
		message:
			'Type in "Klaus" or leave empty.\n' +
			'This error message is purposefully long to show that the default error box ' +
			'wraps decently.'
	}
}

result.add(div({}, 'type in "Klaus" to validate'), textedit({
	field: {
		validator_name: say_my_name,
	},
	val: 'wrong',
}))

result.add(div(0, 'type in "Klaus" to validate'), textedit({
	field: {
		validator_name: say_my_name_long,
	},
	copy_to_clipboard_button: true,
}))

result.add(
	div({style: 'padding-top: 2em'},
		'Check out these inner labels:',
		div({},
			textedit({
				field: {name: "santa's_name", validator_name: say_my_name},
			}),
			textedit({
				field: {label: "devil's name"},
				val: 'Anything goes',
			})
		)
	)
)

result.add(passedit({
	field: {
		validator_name: say_my_name,
		label: 'Password',
	},
	val: 'Klaus',
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=spinedit_demo>
<style>
#result {
   grid-gap: 2px;
	align-items: start;
}
</style>

<x-spinedit val=42></x-spinedit>
<x-spinedit val=42>Heey</x-spinedit>

<script run>

result.add(div({},
	spinedit({button_style: 'up-down', val: 42, field: {}}),
	spinedit({button_style: 'up-down', field: {label: 'Hey hey'}})
))

result.add(div({},
	spinedit({button_style: 'left-right', val: 42, field: {}}),
	spinedit({button_style: 'left-right', field: {label: 'Dis look good?'}})
))

result.add(div({},
	spinedit({val: 1, field: {min: -2, max: 5, multiple_of: 1.5}, button_placement: 'right'}),
	spinedit({field: {min: -2, max: 5, multiple_of: 1.5, label: 'How bout dis?'}, button_placement: 'right'}),
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=tagsedit_demo>
<div id=main></div>
<script run>

main.add(
	tagsedit({
		field: {
			validate: function(v) {
				return v.includes('bananas') || 'Can\'t renounce bananas'
			},
		},
		val: ['apples', 'bananas', 'mangos'],
	}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=slider_demo>
<script run>

result.add(
	div({}, 'Slider 1'),
	slider({
		field: {
			validator_custom: field => ({
				valiate: v => v >= .2 && v <= .8,
				message: 'Value not between .2 and .8',
			}),
		},
		val: .5,
	}))

result.add(
	div({}, 'Slider 2'),
	slider({
		from: 1000, to: 2000,
		field: {
			multiple_of: 200, min: 1300, max: 1700,
		},
		val: 1500,
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=image_demo>
<div id=main></div>
<script run>

main.add(
	image({nav: global_val_nav(), url_template: '/media/gif/porsche.gif', w: 300, h: 200})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=placeedit_demo>
<div id=main></div>
<script run>

let api = editbox({field: {}, val: 'AIzaSyAuM6W_Hh2IagBOi4zR6owafO5yNyJLGiM'})
api.on('val_changed', function(v) {
	if (v) init_google_places_api(v)
})
main.add(api)

let addr = placeedit({field: {}, val: 'Somewhere'})
main.add(addr)

let gmap = googlemaps({nav: addr.nav, col: addr.col})
main.add(gmap)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=listbox_demo>
<div id=main></div>
<script run>

lb = listbox({
	items: [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	],
	val_col: 0,
	field: {},
	val: 'Bananas',
})

hlb = hlistbox({
	items: [
		'Works',
		'Horizontally',
		'Too',
	],
})

sb = select_button({
	items: [
		'Choose',
		'One',
		'Of',
		'Us',
	],
	val_col: 0,
	field: {},
	val: 'One',
})

main.add(lb, hlb, div({}, html('<h3>select_button</h3>'), sb))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=linear_form_demo>
<div class="x-linear-form">
	<x-checkbox id=c1 val=1>
		Check me baby
		<info>
			...because if you won't<br>
			somebody else will
		</info>
	</x-checkbox>
	<x-radiogroup id=r1 val=1>
		<info>Info box, can put any HTML in here.<br>But it will be gray and small.</info>
		<div val=1>Choose me!</div>
		<div val=2>Me, me<br>me, me, me!</div>
	</x-radiogroup>
	<x-textedit label=Wasup>
		<info>Wasa bii</info>
	</x-textedit>
</div>
</template>

<!--------------------------------------------------------------------------->

<template id=cssgrid_demo>
<div id=main></div>
<script run>

cg = cssgrid({
	items: [
		date_dropdown ({val: day(time()), pos_x: 3, pos_y: 1}),
		input         ({val: 'hello1', pos_x: 2, pos_y: 2}),
		input         ({val: 'hello2', pos_x: 1, pos_y: 3}),
	],
})

cg.style.height = '100%'

cg.widget_editing = true

main.add(cg)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=calendar_demo>
<div id=main></div>
<script run>

main.add(calendar({
	field: {},
}))

/*
main.add(calendar({
	val: day(time(), 1),
	field: {
		validate: function(v) {
			if (day(v) == day(time()))
				return 'Can\'t have today.'
			if (day(v) == day(time(), 1))
				return 'Can\'t have tomorrow.'
		},
	},
}))
*/

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_demo>
<div id=main style="height: 100%; display: flex;"></div>
<script run>

let checked = () => html('<div class="fa fa-check"></div>')

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

let fields = [
	{name: 'id'        , w:  50, min_w:  30, type: 'number', editable: false},
	{name: 'index'     , w:  50, type: 'number', editable: false},
	{name: 'active'    , w:  30, type: 'bool', true_text: checked, false_text: ''},
	{name: 'name'      , w: 150, min_w:  50, max_w: 400, validate: starts_with_a, filter_by: true},
	{name: 'parent_id' , w:  50, min_w:  50, type: 'number', allow_null: true, editable: false, focusable: false},
	{name: 'random_num', w: 130, allow_null: true, type: 'number',
		label: 'Random Number',
		info: 'Just a random number\ngenerated here on the client'},
	{name: 'date'      , w: 120, allow_null: true, type: 'time', filter_by: true},
]

let rows = []

for (let i = 0; i <= 10000; i++) {
	let id         = i
	let name       = 'record '+i
	let parent_id  = i > 1 ? (i-1) % 3 : null // floor((random() * i))
	let random_num = floor(random() * 1e9)
	let random_date = clamp(i * 24 * 3600 * 10, 0, time(3000, 0))
	let active = i % 5 == 0
	let row = [id, id, active, name, parent_id, random_num, random_date]
	row.focusable = true // i % 100 >= 85
	rows.push(row)
}

g = grid({
	rowset: {
		fields: fields,
		rows: rows,
		pk: 'id',
		parent_col: 'parent_id',
		index_col: 'index',
	},
	order_by: 'active name:desc',
	tree_col: 'name',
	//can_edit: false,
	can_change_header_visibility: true,
	//can_focus_cells: false,
	//order_by: 'parent_id name:desc',
	can_move_rows: true,
	//enter_edit_on_click_focused: false,
	//can_change_parent: false,
})

main.add(g)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=date_dropdown_demo>
<div id=main></div>
<script run>

d = date_dropdown({
	val: time(),
	field: {
		type: 'date',
		validate: function(v) {
			if (day(v) == day(time()))
				return 'Can\'t have today.'
			if (day(v) == day(time(), 1))
				return 'Can\'t have tomorrow.'
		},
	},
})

main.add(d)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=list_dropdown_demo>
<div id=main></div>
<script run>

function thousand_items() {
	let a = []
	for (let i = 1; i <= 1000; i++)
		a.push('Record '+i)
	return a
}

main.add(
	list_dropdown({
		id: 'dd1',
		rowset: {
			fields: [
				{name: 'name'},
				{name: 'code'},
			],
			rows: [
				['Apples', 'a'],
				['Mananas', 'm'],
				['Bangos', 'b'],
				['Something Else Entirely', 's'],
			],
		},
		val_col: 'code',
		display_col: 'name',
		field: {
			name: 'Here we are',
			validate: function(v) {
				return v != 'm' || 'Can\'t have mananas.'
			},
		},
		val: 'm',
	}),

	list_dropdown({
		id: 'dd2',
		field: {name: 'Here we are again'},
		items: thousand_items(),
		val_col: 0,
		val: 'not-in-list',
	}),

)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=grid_dropdown_demo>
<div id=main></div>
<script run>

main.add(
	grid_dropdown({
		rowset: {
			fields: [
				{w:  50, name: 'id', type: 'number', visible: false},
				{w: 150, name: 'name'},
				{w: 150, name: 'date', type: 'date'},
			],
			rows: [
				[1, 'Hey Dude', day(time())],
				[2, 'Wasup'   , month(time())],
				[3, 'Nuthin'  , year(time())],
			],
		},
		val_col: 'id',
		display_col: 'name',
		field: {},
		val: 4,
	})
)

rows2 = []
for (let i = 1; i <= 1e5; i++)
	rows2.push([i, 'Hey Dude #'+i])

main.add(
	grid_dropdown({
		rowset: {
			fields: [
				{w:  50, name: 'id', type: 'number', visible: false},
				{w: 200, name: 'name'},
			],
			rows: rows2,
		},
		val_col: 'id',
		display_col: 'name',
		field: {},
		val: 42,
	})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=countries_listbox_demo>
<div id=main></div>
<script run>

clb = countries_listbox({
	field: {},
	val: 'RO',
})
main.add(clb)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=country_dropdown_demo>
<div id=main></div>
<script run>

cd = country_dropdown({
	field: {},
	val: 'RO',
})
main.add(cd)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=dropdown_modes_demo>
<div id=main></div>
<script run>

function items() {
	return [
		'Apples',
		'Bananas',
		'Something Else Entirely',
	]
}

function p(mode, ...args) {
	return div({style: 'margin-top: 1em'}, html('<b>'+mode+'</b> mode:<br>'), ...args)
}

main.add(
	p('default', 'variable-width, no-wrap with min-width aligned with other inputs'),
	date_dropdown({field: {type: 'date'}, val: time()}),
	div(),
	list_dropdown({field: {}, items: items()}),

	p('inline', 'variable-width, no-wrap, with no min-width (shrink-wrapped), baseline-aligned'),
	date_dropdown({field: {type: 'date'}, mode: 'inline', val: time()}),
	div(),
	list_dropdown({field: {}, mode: 'inline', items: items()}),

	p('wrap', 'fixed-width, auto-wrap'),
	date_dropdown({field: {type: 'date'}, mode: 'wrap', val: time()}),
	div(),
	list_dropdown({field: {}, mode: 'wrap', items: items(), val: 'Something Else Entirely'}),

	p('fixed', 'fixed-width, no-wrap, overflow hidden'),
	date_dropdown({field: {type: 'date'}, mode: 'fixed', val: time()}),
	div(),
	list_dropdown({id: 'xx', field: {}, mode: 'fixed', items: items(), val: 'Something Else Entirely'})
)

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=inline_inputs_demo>
<div id=main></div>
<script run>

main.add(div({style: 'line-height: 3'},
	'All ',
	textedit({
		style: 'min-width: 4em',
		label: 'imma input',
		mode: 'inline',
		val: 'inputs',
	}),
	'are baseline-aligned',
	spinedit({
		label: 'imma spinner',
		style: 'min-width: 6em',
		mode: 'inline',
		val: 42,
	}),
	', including dropdowns ',
	/*
	date_dropdown({
		label: 'imma date',
		mode: 'inline',
	})
	,
	*/
	', which can be made to wrap-to-fit or grow-to-fit, and even',
	button({
		text: 'buttons.',
		primary: true,
		action: function() { pr('clicked') },
	}),
	'This stays true under different fonts, font sizes and line heights.'
))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=rowset_form_demo>
<div id=main></div>
<script run>

r = rowset({
	fields: [
		{w: 100, name: 'id', type: 'number'},
		{w: 100, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
})

g = grid({w: 200, h: 200, rowset: r})

i1 = input({nav: g, col: 'name'})

main.add(div({}, g), i1)

main.add(button({
	text: 'unfocus row',
	action: function() { g.focus_cell(false) },
}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=lookup_col_demo>
<div id=main></div>
<script run>

fruits = rowset({
	fields: [
		{w:  50, name: 'id', type: 'number'},
		{w: 150, name: 'name'},
	],
	rows: [
		[1, 'apples'],
		[2, 'bananas'],
	],
	can_change_rows: true,
})

main.add(grid({w: 200, h: 200, rowset: fruits}))

r = rowset({
	fields: [
		{w: 100, name: 'fruit_id', type: 'number', align: 'left', label: 'fruit',
			lookup_rowset: fruits,
			lookup_col: 'id',
			display_col: 'name',
		},
	],
	rows: [
		[1],
		[2],
		[1],
	],
})

main.add(grid({w: 200, h: 200, rowset: r}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=charts_demo>
<style>
#result {
	display: block;
}
</style>
<script run>

g = grid({
	rowset: {
		fields: [
			{name: 'date', type: 'time', has_time: false, w: 60},
			{name: 'country', w: 60},
			{name: 'sector', w: 70},
			{name: 'output', type: 'number', w: 40},
		],
		rows: [
			[year(time(), 0), 'Algeria', 'Energy'        ,  80],
			[year(time(), 1), 'Algeria', 'Chickens'      , 100],
			[year(time(), 2), 'Algeria', 'Chickens'      , 150],
			[year(time(), 0), 'Canada' , 'Chickens'      ,  20],
			[year(time(), 1), 'Canada' , 'Geese'         ,  10],
			[year(time(), 1), 'Canada' , 'Geese'         , 120],
			[year(time(), 2), 'Canada' , 'Geese'         ,  50],
			[year(time(), 0), 'Croatia', 'Science'       , 100],
			[year(time(), 0), 'Croatia', 'Chickens'      , 200],
			[year(time(), 1), 'Croatia', 'Energy'        , 150],
			[year(time(), 1), 'Croatia', 'Energy'        , 120],
			[year(time(), 2), 'Croatia', 'Chickens'      , 180],
			[year(time(), 2), 'Croatia', 'Energy'        ,  50],
		],
	},
	h: 200,
})

result.add(g)

// if (0)
result.add(chart({
	nav: g,
	sum_cols: 'output',
	group_cols: 'country sector',
	style: 'height: 500px',
}))

if (0)
result.add(chart({
	nav: g,
	sum_cols: 'output',
	group_cols: 'sector',
	shape: 'stack',
}))

if (0)
result.add(chart({
	nav: g,
	sum_cols: 'output',
	split_cols: 'country',
	group_cols: 'date/0/month/1',
	shape: 'area_dots',
	style: 'height: 250px',
}))

// result.add(chart({
// 	nav: g,
// 	sum_cols: 'output',
// 	group_cols: 'country date',
// 	['group_cols.date.range_freq']: 1,
// 	['group_cols.date.range_unit']: 'month',
// 	shape: 'column',
// }))

//result.add(chart({
//	nav: g,
//	sum_cols: 'output',
//	group_cols: 'country date',
//	['group_cols.date.range_freq']: 1,
//	['group_cols.date.range_unit']: 'month',
//	shape: 'bar',
//}))

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_demo>
<div id=main></div>
<script run>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.txt',
	// timeout: 2,
	slow_timeout: .5,
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	done     : function(...args) { log('done'       , ...args) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=ajax_json_demo>
<div id=main></div>
<script run>

pre = tag('pre')
main.add(pre)
function log(...args) { pre.add(args.join(' '), '\n') }

let req = ajax({
	url: '/ajax-test.json',
	upload: {a: 5, b: 7},
	slow     : function(...args) { log('slow'       , ...args) },
	progress : function(...args) { log('progress'   , ...args) },
	fail     : function(...args) { log('fail'       , ...args) },
	success  : function(j)       { log('success'    , json(j)) },
}).send()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=data_grid_demo>
<div id=main></div>
<script run>

function starts_with_a(s) {
	return s.lower().starts('a') || 'Name must start with "A"'
}

var data = {
	fields: [
		{name: 'id'   , w:  60, min_w:  30, type: 'number', editable: false},
		{name: 'name' , w:  70, min_w:  50, max_w: 200, validate: starts_with_a},
		{name: 'date' , w: 140, allow_null: true, type: 'date'},
	],
	pk: 'id',
	url: 'rowset.json/test_static',
	slow_timeout: 1,
}

d = rowset(data)

g = grid({
	rowset: d,
	w: 500,
	h: 200,
})

main.add(g)

log = tag('pre')
main.add(log)

d.on('row_changed', function() {
	log.html = json(d.pack_changes(), null, 3)
})

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<template id=query_demo>
<div id=main></div>
<script run>

d = global_rowset('test_query')

g = grid({
	rowset: d,
	w: 500,
	h: 200,
	//remove_row_on: 'exit_row',
})

main.add(g)

d.load()

</script>
</template>

<!--------------------------------------------------------------------------->

<script>

on_dom_load(function() {
	init_components()
})

// ace.config.set('basePath', '/ace')

ace_editor = ace.edit(code, {
	mode: 'ace/mode/javascript',
	highlightActiveLine: false,
	showGutter: false,
	printMargin: false,
	displayIndentGuides: false,
	tabSize: 3,
})

// disable Tab in the editor since we need to demo tab navigation.
ace_editor.commands.removeCommand(ace_editor.commands.byName.indent)
ace_editor.commands.removeCommand(ace_editor.commands.byName.outdent)

function get_script() {
	return ace_editor.getSession().getValue()
}

function set_script(s) {
	ace_editor.getSession().setValue(s)
}

function run_script() {
	result.unsafe_html = get_script()
	inspect.clear()
	// inspect.
}

let i = 0
$('template').each(function(e) {
	if (!e.id.ends('_demo'))
		return
	let name = e.id.replace('_demo', '')
	let s = window[name+'_demo'].html.trim()
	let item = div({class: 'demo-list-item'}, name)
	demo_list.add(item)
	let i1 = i
	item.on('click', function() {

		ace_editor.getSession().setValue(s)
		ace_editor.initial_script = s
		run_script()

		let i0 = load('selected_demo_index')
		let item0 = i0 != null && demo_list.at[i0]
		if (item0)
			item0.class('selected', false)
		item.class('selected', true)
		save('selected_demo_index', i1)

	})
	i++
})

on_dom_load(function() {
	let i = load('selected_demo_index')
	let item = i != null && demo_list.at[i]
	if (item)
		item.click()
	let s = load('script')
	if (s) {
		set_script(s)
		run_script()
		save('script')
	}
})

run_button.on('click', function() {
	run_script()
})

reload_button.on('click', function() {
	save('script', get_script())
	window.location = window.location
})

lights_button.on('click', function() {
	let dark = body.attr('theme') != 'dark'
	set_theme(dark ? 'dark' : null)
	ace_editor.setTheme(dark ? 'ace/theme/tomorrow_night' : null)
	save('dark_mode', dark)
	document.fire('layout_changed')
})

function reset_size_buttons() {
	body.attr('large', false)
	body.attr('medium', false)
	medium_button.attr('pressed', false)
	large_button.attr('pressed', false)
}

medium_button.on('click', function() {
	let v = !body.hasattr('medium')
	reset_size_buttons()
	body.attr('medium', v)
	this.attr('pressed', v)
	save('size', v && 'medium' || null)
})

large_button.on('click', function() {
	let v = !body.hasattr('large')
	reset_size_buttons()
	body.attr('large', v)
	this.attr('pressed', v)
	save('size', v && 'large' || null)
})

on_dom_load(function() {
	if (load('dark_mode') == 'true')
		lights_button.click()
	if (load('size') == 'medium')
		medium_button.click()
	else if (load('size') == 'large')
		large_button.click()
})

</script>
</body>
</html>
